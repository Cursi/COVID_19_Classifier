<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COVID-19 Classifier</title>
    
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://rawgit.com/enyo/dropzone/master/dist/dropzone.js"></script>
    <link rel="stylesheet" href="https://rawgit.com/enyo/dropzone/master/dist/dropzone.css">
    
    <script>
        var isProcessing = false;

        function GetBase64(file) 
        {
            return new Promise((resolve, reject) => 
            {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }

        $("document").ready(() =>
        {
            var myDropzone = new Dropzone("body", 
            { 
                init: function() 
                {
                    this.on("addedfile", function(file) 
                    { 
                        console.log(file);

                        GetBase64(file).then(content =>
                        {
                            $.ajax
                            ({
                                type: "POST",
                                url: "/upload",
                                dataType: "json",
                                data: JSON.stringify({ "fileName": file.name, "content" : content }),
                                contentType: 'application/json; charset=x-user-defined',
                                success: function(data)
                                {
                                    console.log(data);
                                    
                                    if(data.status == 200 && data.output === "PROCESSING")
                                    {
                                        isProcessing = true;
                                        $("#infoContainer").text("Sit back and relax, it's processing...üë®‚Äçüíª");
                                    }
                                }
                            });
                        });
                    })
                },
                autoProcessQueue: false,
                previewsContainer: false,
                disableClick: true,
                url: "/upload"
            });

            $("body").click((event) =>
            {
                event.preventDefault();
            })

            setInterval(() =>
            {
                if(isProcessing)
                {
                    $.ajax
                    ({
                        type: "POST",
                        url: "/upload",
                        dataType: "json",
                        data: JSON.stringify({ message: "GIVE_RESULTS"} ),
                        contentType: 'application/json; charset=x-user-defined',
                        success: function(data)
                        {
                            console.log(data);
                            
                            if(data.status == 200)
                            {
                                $("#infoContainer").text(data.output);
                            }
                            else
                                $("#infoContainer").text("Couldn't process this file. Try another! ü§∑‚Äç‚ôÄÔ∏è");

                            isProcessing = false;
                        }
                    });
                }
            }, 1000);
        })
    </script>

    <style>
        body
        {
            background-color: #800020;
            cursor: move;
        }

        #infoContainer
        {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            font-size: 2.5em;
            color: rgba(255, 255, 255, 0.8);
            letter-spacing: 1px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="infoContainer">
        Drop it like it's hot! üî•
    </div>
</body>
</html>