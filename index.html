<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Covid19 Classifier</title>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script>
        var isProcessing = false;

        function GetBase64(file) 
        {
            return new Promise((resolve, reject) => 
            {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }

        $("document").ready(() =>
        {
            setInterval(() =>
            {
                if(isProcessing)
                {
                    $.ajax
                    ({
                        type: "POST",
                        url: "/upload",
                        dataType: "json",
                        data: JSON.stringify({ message: "GIVE_RESULTS"} ),
                        contentType: 'application/json; charset=x-user-defined',
                        success: function(data)
                        {
                            console.log(data);
                            
                            if(data.status == 200)
                                $("#classifierOutput").text(data.output);
                            else
                                $("#classifierOutput").text("EROAREEEE");

                            isProcessing = false;
                        }
                    });
                }
            }, 1000);

            $("#uploadForm").submit(function( event ) 
            {
                // Stop form from submitting normally
                event.preventDefault();

                let file = $("#inputFile").prop("files")[0];

                GetBase64(file).then(content =>
                {
                    let jsonObject = 

                    $.ajax
                    ({
                        type: "POST",
                        url: "/upload",
                        dataType: "json",
                        data: JSON.stringify({ "fileName": file.name, "content" : content }),
                        contentType: 'application/json; charset=x-user-defined',
                        success: function(data)
                        {
                            console.log(data);
                            
                            if(data.status == 200 && data.output === "PROCESSING")
                                isProcessing = true;
                        }
                    });
                });
            });
        })
    </script>
</head>
<body>
    Welcome to the classifier! Please pick an excel test dataset...
    <br><br>
    <form id="uploadForm" method="post" action="/upload" encType="multipart/form-data">
        <input id="inputFile" type="file" name="dataset"/>
        <input type="submit" value="Upload"/>
    </form>

    <br>
    <div id="classifierOutput"></div>
</body>
</html>